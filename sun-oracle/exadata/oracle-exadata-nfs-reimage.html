<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="../../_static/favicon/favicon.ico">
    <link rel="icon" sizes="16x16" type="image/png" href="../../_static/favicon/favicon-16x16.png">
    <link rel="icon" sizes="32x32" type="image/png" href="../../_static/favicon/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" type="image/png" href="../../_static/favicon/apple-touch-icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Exadata NFS ReImage &mdash; Ёжъ</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=15bf8b30" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
    <link rel="canonical" href="https://kb.ksomov.ru/sun-oracle/exadata/oracle-exadata-nfs-reimage.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=7f41d439"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Intel Optane Persistent Memory Module" href="oracle-exadata-optane-pmem.html" />
    <link rel="prev" title="Exadata LACP Configure" href="oracle-exadata-lacp.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Ёжъ
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">IT</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../asterisk/index.html">Asterisk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../brocade/index.html">Brocade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../emc/index.html">EMC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bsd/index.html">FreeBSD &amp; OpenBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hds/index.html">HDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../homeassistant/index.html">Smart Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ibm/index.html">IBM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/index.html">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mac/index.html">Mac OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../matrix/index.html">Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mikrotik/index.html">Mikrotik</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Sun &amp; Oracle</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#exadata">Exadata</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="oracle-exadata-cabling-table.html">Cabling Tables for Oracle Exadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="oracle-exadata-fmod-position.html">FMod positions (Flash-card)</a></li>
<li class="toctree-l3"><a class="reference internal" href="oracle-exadata-get-serial.html">Как найти серийный номер Exadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="oracle-exadata-host_access_control.html">Настройки безопасности на Exadata при помощи host_access_control</a></li>
<li class="toctree-l3"><a class="reference internal" href="oracle-exadata-lacp.html">Exadata LACP Configure</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Exadata NFS ReImage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#i">Этап I. Подготовка профиля</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ii">Этап II. Скачивание дистрибутивов</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iii">Этап III. Настройка сервера инсталляции</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iv">Этап IV. Заполнение профиля</a></li>
<li class="toctree-l4"><a class="reference internal" href="#v">Этап V. Инсталляция</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="oracle-exadata-optane-pmem.html">Intel Optane Persistent Memory Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="oracle-exadata-pxe-reimage.html">Exadata PXE ReImage</a></li>
<li class="toctree-l3"><a class="reference internal" href="oracle-exadata-root-unlock.html">Temporary User Lockout On Exadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="oracle-exadata-compute-servers-components.html">Oracle Exadata Database Server Hardware Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="oracle-exadata-storage-servers-components.html">Oracle Exadata Storage Server Hardware Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="oracle-exadata-zdlra-extend-fs.html">How to extend filesystem on Exadata &amp; ZDLRA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#hardware">Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#software">Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#solaris">Solaris</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../uncategorized/index.html">Uncategorized</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vyos/index.html">VyOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tasks/index.html">Планы работ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tourism</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tourism/index.html">Обо всем на свете</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Recipes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../recipes/index.html">Рецепты</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ёжъ</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Sun &amp; Oracle</a></li>
      <li class="breadcrumb-item active">Exadata NFS ReImage</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/jeffscrum/itdrafts/blob/master/source/sun-oracle/exadata/oracle-exadata-nfs-reimage.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="exadata-nfs-reimage">
<span id="oracle-exadata-nfs-reimage"></span><span id="index-0"></span><h1>Exadata NFS ReImage<a class="headerlink" href="#exadata-nfs-reimage" title="Link to this heading"></a></h1>
<p>Прошлая статья потеряла актуальность вследствие ее сложности. Есть более простой и быстрый способ ReImage. Этот вариант подходит для UEFI-систем. На более ранних комплексах я его не пробовал так как сейчас их уже почти не осталось.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Exadata X2-X6 - BIOS-Based System</p></li>
<li><p>Exadata X7-X8 - UEFI-Based System</p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<dl class="simple">
<dt>Для проведения re-image нам потребуется:</dt><dd><ul class="simple">
<li><p>Профиль OEDA, приготовленный в Linux</p></li>
<li><p>Сервер с Linux</p></li>
<li><p>NFS Server</p></li>
<li><p>DHCP Server</p></li>
</ul>
</dd>
</dl>
</div>
<section id="i">
<h2>Этап I. Подготовка профиля<a class="headerlink" href="#i" title="Link to this heading"></a></h2>
<p>Нужно подготовить профиль инсталляции в OEDA (Oracle Exadata Deployment Assistant).
Для подготовки <strong>нужно использовать только Linux версию. Это важный момент!</strong> Без этого работать будет, но все же, для 100% совместимости лучше брать Linux версию.
Скачать OEDA можно на сайте <a class="reference external" href="https://support.oracle.com/epmos/faces/ui/patch/PatchDetail.jspx?parent=DOCUMENT&amp;sourceId=888828.1&amp;patchId=30640393">support.oracle.com</a>.</p>
<p>После завершения описания конфигурации в OEDA вы получите zip-архив. Внутри вы найдете файл <strong>…-preconf.csv</strong>. Этот файл нужно будет переименовать в <strong>preconf.csv</strong></p>
</section>
<section id="ii">
<h2>Этап II. Скачивание дистрибутивов<a class="headerlink" href="#ii" title="Link to this heading"></a></h2>
<p>Смотрим требования к версии image в ТЗ, после чего смотрим документ <a class="reference external" href="https://support.oracle.com/epmos/faces/DocContentDisplay?_afrLoop=221272342314719&amp;id=888828.1&amp;_afrWindowMode=0&amp;_adf.ctrl-state=vuh4usj6f_109">Doc ID 888828.1</a> на сайте support.oracle.com. В этом документе находим нужную нам версию image и в правом столбце жмем ссылку напротив нужного нам релиза (<em>Supplemental README …</em>). В открывшемся README нужно найти секцию ‘Software and Image files’ в которой описаны все необходимые файлы которые понадобятся для скачивания.</p>
<a class="reference internal image-reference" href="../../_images/exadata-nfs-reimage-1.webp"><img alt="../../_images/exadata-nfs-reimage-1.webp" src="../../_images/exadata-nfs-reimage-1.webp" style="width: 600px;" /></a>
<p>Теперь идем на сайт <a class="reference external" href="https://edelivery.oracle.com/osdc/faces/SoftwareDelivery">edelivery.oracle.com</a> и в строке поиска набираем <em>‘Oracle Exadata Storage Server’</em>, после чего кликаем на нужную нам версию. В верхнем правом углу нажимаем ‘Checkout’ и ‘Continue’, после чего соглашаемся с лицензией и снова ‘Continue’. Проверяем что нам предлагают скачивать те же файлы что мы видели ранее. Скачиваем.</p>
<a class="reference internal image-reference" href="../../_images/exadata-nfs-reimage-2.webp"><img alt="../../_images/exadata-nfs-reimage-2.webp" src="../../_images/exadata-nfs-reimage-2.webp" style="width: 600px;" /></a>
<p>После того как оба файла скачали - распаковываем.
Вам понадобятся 2 файла с образами ОС:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>compute…x86_64.iso</cite></p></li>
<li><p><cite>cell…x86_64.iso</cite></p></li>
</ul>
</div></blockquote>
</section>
<section id="iii">
<h2>Этап III. Настройка сервера инсталляции<a class="headerlink" href="#iii" title="Link to this heading"></a></h2>
<p>В этом шаге нужно настроить DHCP Server и NFS Server. Я делаю это на примере RHEL, но дистрибутив может быть любым.</p>
<section id="id1">
<h3>Установка необходимых пакетов<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>yum<span class="w"> </span>install<span class="w"> </span>dhcp<span class="w"> </span>nfs-utils<span class="w"> </span>rpcbind<span class="w"> </span>vim
</pre></div>
</div>
</section>
<section id="firewall">
<h3>Отключение firewall<a class="headerlink" href="#firewall" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>stop<span class="w"> </span>firewalld
systemctl<span class="w"> </span>disable<span class="w"> </span>firewalld
systemctl<span class="w"> </span>mask<span class="w"> </span>--now<span class="w"> </span>firewalld
</pre></div>
</div>
</section>
<section id="selinux">
<h3>Отключаем SELinux<a class="headerlink" href="#selinux" title="Link to this heading"></a></h3>
<p>Для этого в файле <cite>/etc/selinux/config</cite> изменяем директиву <code class="docutils literal notranslate"><span class="pre">SELINUX=enforcing</span></code> на <code class="docutils literal notranslate"><span class="pre">SELINUX=disabled</span></code>, после чего перезагружаемся.</p>
</section>
<section id="nfs">
<h3>Настройка NFS сервера<a class="headerlink" href="#nfs" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>nfs-server
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>rpcbind
mkdir<span class="w"> </span>-p<span class="w"> </span>/export
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;/export    *(ro,sync,no_root_squash)&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/exports
systemctl<span class="w"> </span>restart<span class="w"> </span>rpcbind
systemctl<span class="w"> </span>restart<span class="w"> </span>nfs-server
systemctl<span class="w"> </span>status<span class="w"> </span>nfs
showmount<span class="w"> </span>-e
rpcinfo<span class="w"> </span>-p
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul class="simple">
<li><p>NFS debug enable: rpcdebug -m nfsd all</p></li>
<li><p>NFS debug disable: rpcdebug -m nfsd -c all</p></li>
</ul>
</div>
</section>
<section id="dhcp">
<h3>Настройка DHCP сервера<a class="headerlink" href="#dhcp" title="Link to this heading"></a></h3>
<p>Создаем файл конфигурации <cite>/etc/dhcp/dhcpd.conf</cite>.
В прошлой версии статьи я добавлял каждый сервер вручную, но сейчас отказался от этого, так как это долго. Я разрешил dhcpd раздавать адреса всем подряд. Это удобно в том случае если у вас изолированный сегмент сети (например стойка не подключена к сети заказчика). Если же вы делаете перезаливку только одного сервера, то лучше в явном виде перечислять хосты которые получат адрес и какой именно. (параметр ‘allow unknown-clients’ нужно изменить на ‘deny unknown-clients’).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1">#  DHCP Server Configuration file.</span>
<span class="c1">#   see /usr/share/doc/dhcp*/dhcpd.conf.example</span>
<span class="c1">#   see dhcpd.conf(5) man page</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="w"> </span>
<span class="c1">#################################### MAC ADDRESS ######################################</span>
<span class="c1">#  Note:                                                                              #</span>
<span class="c1">#   The eth0 MAC address is the &#39;fru_macaddress&#39; field from /SYS/MB/NET0 in the ILOM  #</span>
<span class="c1">#   or /SYS/SMOD0/MB/NET0 or /SYS/SMOD/MB/NET0                                        #</span>
<span class="c1">#   or                                                                                #</span>
<span class="c1">#   Run &#39;ibhosts&#39; to get a list of node names and IP addresses if use InfiniBand      #</span>
<span class="c1">#######################################################################################</span>
<span class="w"> </span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># - Global options</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="w"> </span>
allow<span class="w"> </span>unknown-clients<span class="p">;</span>
not<span class="w"> </span>authoritative<span class="p">;</span>
<span class="w"> </span>
allow<span class="w"> </span>bootp<span class="p">;</span>
allow<span class="w"> </span>booting<span class="p">;</span>
<span class="w"> </span>
option<span class="w"> </span>ip-forwarding<span class="w">    </span>false<span class="p">;</span><span class="w">  </span><span class="c1"># No IP forwarding</span>
option<span class="w"> </span>mask-supplier<span class="w">    </span>false<span class="p">;</span><span class="w">  </span><span class="c1"># Don&#39;t respond to ICMP Mask req</span>
<span class="w"> </span>
default-lease-time<span class="w"> </span><span class="m">14400</span><span class="p">;</span>
max-lease-time<span class="w"> </span><span class="m">28800</span><span class="p">;</span>
<span class="w"> </span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># - Subnet Section</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="w"> </span>
subnet<span class="w"> </span><span class="m">192</span>.168.1.0<span class="w"> </span>netmask<span class="w"> </span><span class="m">255</span>.255.255.0<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>option<span class="w"> </span>subnet-mask<span class="w">    </span><span class="m">255</span>.255.255.0<span class="p">;</span>
<span class="w">  </span>option<span class="w"> </span>routers<span class="w">        </span><span class="m">192</span>.168.1.254<span class="p">;</span><span class="w">     </span><span class="c1"># My laptop IP (InstallServer)</span>
<span class="w">  </span>option<span class="w"> </span>domain-name<span class="w">    </span><span class="s2">&quot;evil.corp&quot;</span><span class="p">;</span>
<span class="w">  </span>range<span class="w">                 </span><span class="m">192</span>.168.1.40<span class="w"> </span><span class="m">192</span>.168.1.199<span class="p">;</span>
<span class="w">  </span>next-server<span class="w">           </span><span class="m">192</span>.168.1.254<span class="p">;</span>
<span class="w">  </span>option<span class="w"> </span>root-path<span class="w">      </span><span class="s2">&quot;192.168.1.254:/tftpboot/linux-install&quot;</span><span class="p">;</span>
<span class="o">}</span>
<span class="w"> </span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># - Clean DHCP Server leases</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#    1. service dhcpd stop</span>
<span class="c1">#    2. rm -f /var/lib/dhcpd/dhcpd.leases~</span>
<span class="c1">#    3. rm -f /var/lib/dhcpd/dhcpd.leases</span>
<span class="c1">#    3. touch /var/lib/dhcpd/dhcpd.leases</span>
<span class="c1">#    4. service dhcpd start</span>
<span class="c1">#</span>
<span class="w"> </span>
group<span class="w"> </span><span class="o">{</span>
<span class="w">  </span>next-server<span class="w"> </span><span class="m">10</span>.64.75.254<span class="p">;</span>
<span class="w">  </span>option<span class="w"> </span>root-path<span class="w"> </span><span class="s2">&quot;10.64.75.254:/tftpboot/linux-install&quot;</span><span class="p">;</span>
<span class="w"> </span>
<span class="w">  </span>host<span class="w"> </span>db01<span class="w"> </span><span class="o">{</span>
<span class="w">   </span>hardware<span class="w"> </span>ethernet<span class="w"> </span>6a:ee:0b:de:fc:f5<span class="p">;</span>
<span class="w">    </span>fixed-address<span class="w"> </span><span class="m">192</span>.168.1.40<span class="p">;</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1">#  .END FILE.</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>На всякий случай проверяем, что в файле конфигурации нет ошибок</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dhcpd<span class="w"> </span>-t<span class="w"> </span>-cf<span class="w"> </span>/etc/dhcp/dhcpd.conf
</pre></div>
</div>
<p>Перезапускаем DHCP Server</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>dhcpd.service
systemctl<span class="w"> </span>restart<span class="w"> </span>dhcpd.service
systemctl<span class="w"> </span>status<span class="w"> </span>dhcpd.service
</pre></div>
</div>
</section>
</section>
<section id="iv">
<h2>Этап IV. Заполнение профиля<a class="headerlink" href="#iv" title="Link to this heading"></a></h2>
<p>Чтобы инсталлятор мог использовать профиль, его нужно дозаполнить.
Для этого нужно поочередно зайти на ILOM каждого сервера и выполнить команду <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">/SYS/MB/NET0</span></code> или <code class="docutils literal notranslate"><span class="pre">/SYS/SMOD0/MB/NET0</span></code> или <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">/SYS/SMOD/MB/NET0</span></code> (зависит от модели серера) и ищем <em>mac</em> в строке <cite>fru_macaddress</cite> или командой <code class="docutils literal notranslate"><span class="pre">ibhosts</span></code>, если вдруг будете ставить через Infiniband.
После того как вы получили mac-адрес интерфейса, его необходимо вписать в файл <cite>preconf.csv</cite>. Сделать это нужно между запятыми, после слова “Management” и перед указанием IP-адреса для нужного сервера (<a class="reference download internal" download="" href="../../_downloads/c91b4ee7201e92d8da8c6c134677c773/example.preconf.csv"><code class="xref download docutils literal notranslate"><span class="pre">пример</span> <span class="pre">готового</span> <span class="pre">файла</span></code></a>).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>... bondeth0,eth0::::,Management,&lt;mac:address:paste:here&gt;,10.152.240.159,255.255.252.0 ...
</pre></div>
</div>
<p>После того как mac-адреса для всех серверов будут заполнны, файл необходимо положить рядом с iso-файлом. (например ‘/export/preconf.csv’)</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Будьте внимательны со строками которые заполняете.
Файл нельзя редактировать через EXCEL – используйте текстовый редактор.</p>
</div>
</section>
<section id="v">
<h2>Этап V. Инсталляция<a class="headerlink" href="#v" title="Link to this heading"></a></h2>
<p>Настраиваем статический ip-адрес или dhcp в ILOM каждого сервера. Адрес должен быть в одной сети с NFS-сервером.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd /SP/network
set pendingipdiscovery=dhcp
set commitpending=true

или

cd /SP/network
set pendingipdiscovery=static
set pendingipaddress=192.168.1.10
set pendingipnetmask=255.255.255.0
set pendingipgateway=192.168.1.1254
set commitpending=true
</pre></div>
</div>
<p>В ILOM нужно примонтировать iso-образ в зависимости от типа сервера и указать серверу загрузиться с cdrom.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>set /SP/services/kvms/host_storage_device/remote/ server_URI=nfs://192.168.1.254:/export/compute.iso
set /SP/services/kvms/host_storage_device/remote/ server_URI=nfs://192.168.1.254:/export/cell.iso
set /SP/services/kvms/host_storage_device/ mode=remote
set /HOST boot_device=cdrom
start /SYS
start /SP/console
start /HOST/console
</pre></div>
</div>
<p>Сервер загрузится c виртуального cdrom’a, получит ip-адрес от dhcp-сервера, сам найдет профиль и начнет инсталляцию.
Если потребуется, сервер сам обновит нужные микрокоды, перезагрузится и т.д. - следите за логами на экране.</p>
<p>В конечном итоге запустится тест и после его прохождения сервер напишет о том что установка закончена.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2020-03-10 15:50:44 +0300 2020-03-10 15:50:44 +0300 [FACTORY_TEST_END] Post installation tests ended with success
2020-03-10 15:50:44 +0300 2020-03-10 15:50:44 +0300 [FACTORY_COMPLETE] Imaging ended with success
</pre></div>
</div>
<p>Со STORAGE-серверами у меня было так что последняя проверка проходила неудачно и тогда сервер писал вот так:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2020-03-10 15:34:50 +0300 The first boot completed with FAILURE
2020-03-10 15:34:50 +0300 2020-03-10 15:34:50 +0300 [FACTORY_ERROR] Overall status failure
2020-03-10 15:34:50 +0300 2020-03-10 15:34:50 +0300 [FACTORY_TEST_END] Post installation tests ended with failure
2020-03-10 15:34:50 +0300 2020-03-10 15:34:50 +0300 [FACTORY_COMPLETE] Imaging ended with failure
</pre></div>
</div>
<p>Перезагружаем сервер – <code class="docutils literal notranslate"><span class="pre">shutdown</span> <span class="pre">-r</span> <span class="pre">now</span></code>. После перезагрузки сервер через некоторое время еще раз запустит все необходимые проверки и напишет что все OK.</p>
<p>Далее можно переходить к установке БД, настройке GRID и ASM. Возможно я опишу этот процесс в дальнейшем, но пока остановимся на этом.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<dl class="simple">
<dt>Скрипты, которые запускает сервер для своих проверок:</dt><dd><ul class="simple">
<li><p>Command line is <code class="docutils literal notranslate"><span class="pre">/opt/oracle.cellos/validations/bin/vldrun.pl</span> <span class="pre">-quiet</span> <span class="pre">-all</span></code></p></li>
<li><p>Command line is <code class="docutils literal notranslate"><span class="pre">/opt/oracle.cellos/validations/bin/vldrun.pl</span> <span class="pre">-mode</span> <span class="pre">first_boot</span> <span class="pre">-force</span> <span class="pre">-quiet</span> <span class="pre">-all</span></code></p></li>
</ul>
</dd>
</dl>
</div>
<hr class="docutils" />
<p>Для автоматизации получения mac-адресов с большого количества серверов можно внести адреса их ilom в файл <cite>servers.lst</cite>, после чего выполнить скрипт который запишет mac-адреса в файл <cite>mac_adr.txt</cite>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span>h<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>cat<span class="w"> </span>servers.lst<span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$h</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>mac_adr.txt
<span class="w">  </span>ssh<span class="w"> </span>-oStrictHostKeyChecking<span class="o">=</span>no<span class="w"> </span><span class="nv">$h</span><span class="w"> </span><span class="s1">&#39;ipmitool sunoem cli &quot;show /SYS/SMOD0/MB/NET0&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;fru_macaddress&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>mac_adr.txt
<span class="w">  </span>ssh<span class="w"> </span>-oStrictHostKeyChecking<span class="o">=</span>no<span class="w"> </span><span class="nv">$h</span><span class="w"> </span><span class="s1">&#39;ipmitool sunoem cli &quot;show /SYS/MB/NET0&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;fru_macaddress&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>mac_adr.txt
<span class="k">done</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="oracle-exadata-lacp.html" class="btn btn-neutral float-left" title="Exadata LACP Configure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="oracle-exadata-optane-pmem.html" class="btn btn-neutral float-right" title="Intel Optane Persistent Memory Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Jeff Scrum.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>